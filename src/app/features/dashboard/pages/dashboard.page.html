<ion-header translucent="true">
    <ion-toolbar>
        <ion-buttons slot="start">
            <ion-menu-button autoHide="false"></ion-menu-button>
        </ion-buttons>
        <ion-title>{{ today | date: 'EEEE, d MMM' }}</ion-title>
        <ion-button slot="end" fill="clear" class="streak-trigger" (click)="openStreakModal()">
            <ion-badge color="primary" class="streak-badge">
                <ion-icon name="flame-outline"></ion-icon>
                {{ streakDays }}
            </ion-badge>
        </ion-button>
        <ion-button slot="end" fill="clear" class="slots-trigger" (click)="onSlotsIndicatorClick()">
            <ion-badge color="medium" class="slots-badge">+{{ unlockedSlots }}</ion-badge>
        </ion-button>
    </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
    <main class="dashboard">
        <section class="section-copy">
            <h1>Tu accion de hoy</h1>
            <ion-text color="medium">
                <p>Marca solo lo que completes. Sin ruido, solo progreso real.</p>
            </ion-text>
        </section>

        <section class="section-habits">
            @if (habits.length) {
                <ion-list lines="none">
                    @for (habit of habits; track habit.id) {
                        <ion-item class="habit-item">
                            <ion-icon slot="start" name="checkmark-circle-outline"></ion-icon>
                            <ion-label>{{ habit.name }}</ion-label>
                            <ion-checkbox
                                slot="end"
                                color="primary"
                                [checked]="completedHabitIds.has(habit.id)"
                                (ionChange)="onHabitToggle(habit.id, $event.detail.checked)"
                            ></ion-checkbox>
                        </ion-item>
                    }
                </ion-list>
            } @else {
                <ion-text color="medium">
                    <p class="empty">No hay habitos iniciales. Agrega al menos uno.</p>
                </ion-text>
            }
        </section>

        <section class="section-progress">
            <p>{{ progressLabel }}</p>
            <ion-progress-bar color="primary" [value]="progressValue"></ion-progress-bar>
        </section>
    </main>

    <ion-modal [isOpen]="showUnlockRewardModal" [backdropDismiss]="false">
        <ng-template>
            <ion-content class="reward-modal-content">
                <div class="reward-modal-body">
                    <ion-text color="primary">
                        <h2>Racha desbloqueada</h2>
                    </ion-text>
                    <ion-text color="light">
                        <p>
                            Lograste 7 dias seguidos. Ya puedes expandir tus habitos iniciales de 3 a 5.
                        </p>
                    </ion-text>

                    <div class="reward-actions">
                        <ion-button expand="block" color="primary" (click)="claimAndGoToCreateHabits()">
                            Agregar habitos
                        </ion-button>
                        <ion-button expand="block" fill="outline" color="medium" (click)="claimAndContinue()">
                            Continuar
                        </ion-button>
                    </div>
                </div>
            </ion-content>
        </ng-template>
    </ion-modal>
</ion-content>
